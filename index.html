<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VoiceNote - Multi-language Speech to Text</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 1rem 0; /* ADDED vertical padding to ensure content can scroll */
      background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
      color: #333;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      /* CHANGE: Align to the start to allow scrolling */
      align-items: flex-start; 
    }
    .container {
      background-color: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      width: min(90vw, 800px);
      /* CHANGE: Use auto-height to fit content properly */
      min-height: auto; 
      height: auto;
      margin: 2rem auto;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .header i {
      font-size: 3rem;
      color: #0984e3;
      margin-bottom: 0.5rem;
    }
    h1 {
      text-align: center;
      color: #4a4a4a;
      margin-bottom: 0.5rem;
      font-size: 2.5rem;
      font-weight: 300;
    }
    .subtitle {
      text-align: center;
      color: #888;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      font-weight: 300;
    }
    .voice-icons {
      text-align: center;
      margin-bottom: 1rem;
    }
    .voice-icons i {
      display: none;
    }
    .voice-image {
      display: block;
      margin: 0 auto 1rem auto;
      max-width: 150px;
      opacity: 0.8;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      align-items: center;
    }
    label {
      font-weight: bold;
      margin-right: 0.5rem;
    }
    select {
      font-size: 1rem;
      padding: 0.75rem;
      margin: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #fff;
      cursor: pointer;
      transition: border-color 0.3s ease;
    }
    select:hover {
      border-color: #0984e3;
    }
    button {
      font-size: 1rem;
      padding: 0.75rem 1.5rem;
      margin: 0.5rem;
      border: none;
      border-radius: 5px;
      background-color: #0984e3;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-weight: bold;
    }
    button:hover {
      background-color: #0652dd;
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    #transcript {
      width: 100%;
      /* CHANGE: Reduced height from 500px to better fit on all screens */
      height: 350px; 
      /* NEW: Allows the textarea to grow if extra space is available */
      flex-grow: 1; 
      font-size: 1.1rem;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: none;
      background-color: #fafafa;
      line-height: 1.5;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: border-color 0.3s ease;
      overflow-y: auto;
    }
    #transcript:focus {
      outline: none;
      border-color: #0984e3;
    }
    #status {
      text-align: center;
      margin-top: 1.5rem;
      font-style: italic;
      color: #888;
      font-size: 1rem;
    }
    footer {
      text-align: center;
      margin-top: 2rem;
      font-size: 0.9rem;
      color: #aaa;
      border-top: 1px solid #eee;
      padding-top: 1rem;
    }
    @media (max-width: 768px) {
      body {
        /* Ensure scrolling is enabled for the entire page */
        display: block; 
        overflow-y: auto;
        padding: 1rem;
      }
      .container {
        width: 100%;
        padding: 1rem;
        margin: 0;
        min-height: auto;
        height: auto;
        box-shadow: none;
      }
      h1 {
        font-size: 2rem;
      }
      #controls {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
      }
      select, button {
        width: 100%;
        max-width: 300px;
        margin: 0.25rem auto;
      }
      /* CHANGE: Reduced height from 60vh to 35vh for better visibility of footer */
      #transcript {
        height: 35vh; 
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>VoiceNote</h1>
      <p class="subtitle">Optimized for Telugu and Tamil Speech to Text</p>
      <div class="voice-icons">
      </div>
    </div>
    <div id="controls">
      <label for="language"><i class="fas fa-globe"></i> Select Language: </label>
      <select id="language"></select>
      <label for="translateLanguage"><i class="fas fa-language"></i> Translate to: </label>
      <select id="translateLanguage"></select>
      <label for="noiseReduction" style="display: none;"><input type="checkbox" id="noiseReduction"> Enable Noise Reduction</label>
      <label for="audioFile" style="display: none;"><i class="fas fa-upload"></i> Upload Audio File: <input type="file" id="audioFile" accept="audio/*"></label>

      <button id="startBtn"><i class="fas fa-play"></i> Start</button>
      <button id="stopBtn" disabled><i class="fas fa-stop"></i> Stop</button>
      <button id="translateBtn"><i class="fas fa-exchange-alt"></i> Translate</button>
      <button id="saveBtn"><i class="fas fa-save"></i> Save Transcription</button>
      <button id="copyBtn"><i class="fas fa-copy"></i> Copy</button>
      <button id="clearBtn"><i class="fas fa-trash-alt"></i> Clear</button>
    </div>
    <textarea id="transcript" placeholder="Your speech will appear here..." readonly></textarea>
    <div id="status"></div>
    <footer>Powered by Web Speech API</footer>
  </div>

 <script>
document.addEventListener("DOMContentLoaded", () => {
  // ✅ List of languages
  const languages = [
    { code: 'te-IN', name: 'Telugu (India)' },
    { code: 'ta-IN', name: 'Tamil (India)' },
    { code: 'en-US', name: 'English (United States)' },
    { code: 'hi-IN', name: 'Hindi (India)' },
    { code: 'ml-IN', name: 'Malayalam (India)' },
    { code: 'kn-IN', name: 'Kannada (India)' },
    { code: 'mr-IN', name: 'Marathi (India)' },
    { code: 'gu-IN', name: 'Gujarati (India)' },
    { code: 'bn-IN', name: 'Bengali (India)' },
    { code: 'pa-IN', name: 'Punjabi (India)' },
    { code: 'or-IN', name: 'Odia (India)' },
    { code: 'as-IN', name: 'Assamese (India)' },
    { code: 'en-GB', name: 'English (United Kingdom)' },
    { code: 'es-ES', name: 'Spanish (Spain)' },
    { code: 'fr-FR', name: 'French (France)' },
    { code: 'de-DE', name: 'German (Germany)' },
    { code: 'it-IT', name: 'Italian (Italy)' },
    { code: 'zh-CN', name: 'Chinese (Simplified)' },
    { code: 'ja-JP', name: 'Japanese (Japan)' },
    { code: 'ko-KR', name: 'Korean (Korea)' },
    { code: 'ru-RU', name: 'Russian (Russia)' },
    { code: 'ar-SA', name: 'Arabic (Saudi Arabia)' },
  ];

  const languageSelect = document.getElementById('language');
  const translateLanguageSelect = document.getElementById('translateLanguage');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const translateBtn = document.getElementById('translateBtn');
  const transcriptArea = document.getElementById('transcript');
  const statusDiv = document.getElementById('status');
  const saveBtn = document.getElementById('saveBtn');

  // ✅ Populate dropdowns
  languages.forEach(lang => {
    const opt1 = document.createElement('option');
    opt1.value = lang.code;
    opt1.textContent = lang.name;
    languageSelect.appendChild(opt1);

    const opt2 = document.createElement('option');
    opt2.value = lang.code;
    opt2.textContent = lang.name;
    translateLanguageSelect.appendChild(opt2);
  });

  languageSelect.value = 'te-IN';
  translateLanguageSelect.value = 'en-US';

  let recognition;
  let isRecognizing = false;
  let shouldStop = false;
  let accumulatedTranscript = '';

  if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
    statusDiv.textContent = 'Sorry, your browser does not support Speech Recognition.';
    startBtn.disabled = true;
    stopBtn.disabled = true;
    saveBtn.disabled = true;
  } else {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;

    recognition.onstart = () => {
      isRecognizing = true;
      startBtn.disabled = true;
      stopBtn.disabled = false;
      statusDiv.textContent = 'Listening...';
    };

    recognition.onerror = (event) => {
      statusDiv.textContent = 'Error: ' + event.error;
    };

    recognition.onend = () => {
      if (shouldStop) {
        isRecognizing = false;
        startBtn.disabled = false;
        stopBtn.disabled = true;
        statusDiv.textContent = 'Stopped listening.';
      } else {
        recognition.start();
      }
    };

    recognition.onresult = (event) => {
      let interim = '';
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          accumulatedTranscript += event.results[i][0].transcript;
        } else {
          interim += event.results[i][0].transcript;
        }
      }
      transcriptArea.value = accumulatedTranscript + interim;
    };
  }

  startBtn.addEventListener('click', () => {
    shouldStop = false;
    recognition.lang = languageSelect.value;
    accumulatedTranscript = '';
    transcriptArea.value = '';
    recognition.start();
  });

  stopBtn.addEventListener('click', () => {
    shouldStop = true;
    recognition.stop();
  });

  saveBtn.addEventListener('click', () => {
    const text = transcriptArea.value.trim();
    if (!text) return alert('No transcription to save.');
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'transcription.txt';
    a.click();
    URL.revokeObjectURL(url);
  });

  document.getElementById('copyBtn').addEventListener('click', () => {
    const text = transcriptArea.value.trim();
    if (!text) return alert('No transcription to copy.');
    navigator.clipboard.writeText(text);
    alert('Copied to clipboard.');
  });

  document.getElementById('clearBtn').addEventListener('click', () => {
    if (confirm('Clear text?')) transcriptArea.value = '';
  });

  // ✅ Corrected Translation Function
  async function translateText(text, sourceLang, targetLang) {
    const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      return data[0].map(item => item[0]).join(' ');
    } catch (e) {
      console.error('Translation error:', e);
      return null;
    }
  }

  translateBtn.addEventListener('click', async () => {
    if (!navigator.onLine) {
      statusDiv.textContent = 'No internet connection. Translation requires internet.';
      return;
    }

    const text = transcriptArea.value.trim();
    if (!text) return alert('No text to translate.');

    const sourceLang = languageSelect.value.split('-')[0];
    const targetLang = translateLanguageSelect.value.split('-')[0];

    if (sourceLang === targetLang) {
      statusDiv.textContent = 'Source and target languages are the same.';
      return;
    }

    statusDiv.textContent = 'Translating...';
    const translated = await translateText(text, sourceLang, targetLang);

    if (translated) {
      transcriptArea.value = translated;
      statusDiv.textContent = `✅ Translation from ${sourceLang.toUpperCase()} to ${targetLang.toUpperCase()} completed.`;
    } else {
      statusDiv.textContent = '❌ Translation failed. Please try again.';
    }
  });
});
</script>
